<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ isAdmin ? 'All Orders' : 'My Orders' }}</h2>
        <div class="text-muted">
          Total: {{ totalOrders }} orders
        </div>
      </div>
      
      <!-- Filters -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Order Status</label>
              <select class="form-select" [(ngModel)]="statusFilter" (change)="onFilterChange()">
                <option value="">All Statuses</option>
                <option value="PENDING">Pending</option>
                <option value="CONFIRMED">Confirmed</option>
                <option value="PROCESSING">Processing</option>
                <option value="SHIPPED">Shipped</option>
                <option value="DELIVERED">Delivered</option>
                <option value="CANCELLED">Cancelled</option>
              </select>
            </div>
            
            <div class="col-md-3">
              <label class="form-label">Payment Status</label>
              <select class="form-select" [(ngModel)]="paymentStatusFilter" (change)="onFilterChange()">
                <option value="">All Payment Statuses</option>
                <option value="PENDING">Pending</option>
                <option value="PAID">Paid</option>
                <option value="FAILED">Failed</option>
                <option value="REFUNDED">Refunded</option>
                <option value="PARTIALLY_REFUNDED">Partially Refunded</option>
              </select>
            </div>

            <!-- Admin only filter -->
            <div class="col-md-3" *ngIf="isAdmin">
              <label class="form-label">User ID</label>
              <input type="number" class="form-control" [(ngModel)]="userIdFilter" 
                     placeholder="Filter by User ID" (input)="onFilterChange()">
            </div>
            
            <div class="col-md-3 d-flex align-items-end">
              <button class="btn btn-outline-secondary w-100" (click)="loadOrders()" [disabled]="loading">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                Refresh
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading orders...</p>
      </div>

       <!-- Orders List -->
      <div *ngIf="!loading">
        <div *ngIf="orders.length === 0" class="alert alert-info text-center">
          <i class="fas fa-box-open fa-2x mb-3 text-muted"></i>
          <h5>No orders found</h5>
          <p *ngIf="!isAdmin">You haven't placed any orders yet.</p>
          <p *ngIf="isAdmin">No orders match your filters.</p>
          <a *ngIf="!isAdmin" routerLink="/" class="btn btn-primary mt-2">Start Shopping</a>
        </div>

<div *ngFor="let order of orders" class="card mb-3 order-card">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-3">
        <div class="d-flex align-items-center">
          <div class="order-icon me-3">
            <i class="fas fa-box text-primary"></i>
          </div>
          <div>
            <strong class="d-block">#{{ getOrderNumber(order) }}</strong>
            <small class="text-muted">
              {{ getCreatedAt(order) | date:'medium' }}
            </small>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <span class="badge" [ngClass]="getStatusBadgeClass(getStatus(order))">
          {{ getStatus(order) }}
        </span>
      </div>
      
      <div class="col-md-2">
        <span class="badge" [ngClass]="getPaymentStatusBadgeClass(getPaymentStatus(order))">
          {{ getPaymentStatus(order) }}
        </span>
      </div>
      
      <div class="col-md-2">
        <strong class="text-success">â‚¹{{ getTotalAmount(order) | number }}</strong>
        <div class="text-muted small">
          {{ getItemsCount(order) }} items
        </div>
      </div>
      
      <div class="col-md-3 text-end">
        <a [routerLink]="['/order-details', getOrderId(order)]" 
           class="btn btn-outline-primary btn-sm me-2">
          <i class="fas fa-eye me-1"></i>Details
        </a>
        
        <button *ngIf="getPaymentStatus(order) === 'FAILED'"
                class="btn btn-warning btn-sm me-2"
                (click)="retryPayment(order)">
          <i class="fas fa-redo me-1"></i>Retry Payment
        </button>

        <button *ngIf="getStatus(order) === 'DELIVERED'"
                class="btn btn-outline-info btn-sm"
                [routerLink]="['/refund', getOrderId(order)]">
          <i class="fas fa-undo me-1"></i>Refund
        </button>
      </div>
    </div>
    
    <!-- Admin only user info -->
    <div *ngIf="isAdmin && order.user" class="mt-2 pt-2 border-top">
      <small class="text-muted">
        <i class="fas fa-user me-1"></i>
        Customer: {{ order.user.name }} ({{ order.user.email }})
      </small>
    </div>
  </div>
</div>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 1" aria-label="Order pagination">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page === 1">
              <button class="page-link" (click)="onPageChange(page - 1)" [disabled]="page === 1">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
            </li>
            
            <li *ngFor="let p of getPages()" 
                class="page-item" 
                [class.active]="page === p">
              <button class="page-link" (click)="onPageChange(p)">{{ p }}</button>
            </li>
            
            <li class="page-item" [class.disabled]="page === totalPages">
              <button class="page-link" (click)="onPageChange(page + 1)" [disabled]="page === totalPages">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>