<!-- Place file at: src/app/shop/shop.component.html -->
<div class="shop-page container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Products</h3>
    <div *ngIf="loading" class="text-muted small">Loading…</div>
  </div>

  <div class="products-grid">
    <ng-container *ngIf="products.length > 0; else empty">
      <article *ngFor="let p of products; trackBy: trackById" class="colorful-card card">
        <!-- keep router navigation via link — clicking card navigates -->
        <a [routerLink]="['/product', p.id]" class="stretched-link text-decoration-none text-dark">
          <div class="card-img-top img-placeholder">
            <img
              [src]="p.imagePath || 'assets/placeholder.png'"
              [alt]="p.name"
              (error)="onImgError($event)" />
          </div>

          <div class="card-body">
            <h5 class="card-title mb-1">{{ p.name }}</h5>
            <p class="small text-muted mb-2" *ngIf="p.description">{{ p.description }}</p>

            <!-- Price: show currently selected/display price -->
            <div class="price">
              <ng-container *ngIf="p.displayPrice !== undefined && p.displayPrice !== null; else noPrice">
                ₹ {{ p.displayPrice }}
              </ng-container>
              <ng-template #noPrice>Price unavailable</ng-template>
            </div>

            <!-- Sizes: show variant buttons, click selects size (stopPropagation to avoid link) -->
            <div class="sizes mt-2" *ngIf="p.sizes && p.sizes.length">
              <small class="muted">Sizes:</small>
              <div class="size-list">
                <button
                  type="button"
                  class="size"
                  *ngFor="let s of p.sizes"
                  (click)="selectSize(p.id, s.variantId, $event)"
                  [class.selected]="isSizeSelected(p.id, s.variantId)">
                  {{ s.label }}
                  <span *ngIf="s.price !== undefined" class="price-badge">₹{{ s.price }}</span>
                </button>
              </div>
            </div>

          </div>
        </a>
      </article>
    </ng-container>

    <ng-template #empty>
      <div class="alert alert-info">No products found.</div>
    </ng-template>
  </div>

  <div class="mt-4 d-flex justify-content-center">
    <button class="btn btn-outline-primary"
            (click)="loadMore()"
            [disabled]="loading || (total && products.length >= total)">
      Load more
    </button>
  </div>
</div>
