/* FILE: app/admin/product-upload.component.scss
   PLACE: save/replace at app/admin/product-upload.component.scss
   NOTES:
   - Uses only global tokens from styles.scss (Blue Lavender Theme).
   - Primary CTAs use --primary-darker as requested.
   - Mobile-first responsive fixes for neat mobile + desktop behavior.
   - Add "max-height-card" class in template to replace inline height:80vh.
*/

/* ---------- Host ---------- */
:host {
  display: block;
  background: transparent;
  color: var(--text-main);
  padding: 0;
  box-sizing: border-box;
}

/* ---------- Container (page) ---------- */
.admin-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0.86rem;
  padding-bottom: calc(var(--footer-height, 56px) + 28px); /* prevent footer overlap */
  background: linear-gradient(135deg, var(--surface) 0%, var(--primary-hover) 100%);
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border);
  max-height: calc(100vh - 2rem);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  position: relative;
  font-size: clamp(13px, 1.2vw, 14px) !important;
}

/* ---------- Title ---------- */
.admin-container h2 {
  font-size: 2rem;
  font-weight: 800;
  margin-bottom: 1rem;
  color: var(--primary-darker);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* ---------- Card base ---------- */
.card {
  background: var(--surface);
  border-radius: calc(var(--radius) - 2px);
  padding: 1.25rem;
  margin-bottom: 1.25rem;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}
.card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-3px);
}

/* ---------- max-height helper (replace inline height:80vh) ---------- */
.max-height-card {
  max-height: calc(var(--vh, 1vh) * 100 - 160px);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

/* ---------- Forms & Inputs (mobile-first) ---------- */
.form-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
  margin-top: 0.5rem;
}

@media (min-width: 768px) {
  .form-grid { grid-template-columns: repeat(2, 1fr); gap: 1.25rem; }
}

.form-grid label {
  display: block;
  font-weight: 600;
  color: var(--text-main);
  font-size: 0.95rem;
}

.form-grid input,
.form-grid textarea,
.form-grid select,
.form-grid .ng-select {
  margin-top: 0.5rem;
  width: 100%;
  padding: 0.85rem 1rem;
  border-radius: calc(var(--radius) - 2px);
  border: 2px solid var(--border);
  background: var(--white);
  box-shadow: var(--shadow-sm);
}

.form-grid input:focus,
.form-grid textarea:focus,
.form-grid select:focus,
.form-grid .ng-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 6px rgba(177,178,255,0.12);
  transform: translateY(-1px);
}

.form-grid textarea { min-height: 110px; resize: vertical; }
.full-width { grid-column: 1 / -1; }

/* ---------- Buttons ---------- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.6rem 1.2rem;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text-main);
  transition: background-color 0.16s ease, box-shadow 0.16s ease, transform 0.12s ease;
}

/* Primary CTA uses requested darker primary */
.btn-primary {
  background: var(--primary-darker); /* #6E6FFF expected from :root */
  color: var(--white);
  border-color: var(--primary-darker);
  box-shadow: 0 6px 16px rgba(110,111,255,0.08);
}
.btn-primary:hover {
  background: var(--primary);
  border-color: var(--primary);
  transform: translateY(-2px);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--primary);
  color: var(--primary);
}
.btn-outline:hover {
  background: var(--primary);
  color: var(--white);
}

.btn-sm { padding: 0.32rem 0.56rem; font-size: 0.82rem; border-radius: 8px; }

/* ---------- Load / control row ---------- */
.load-section {
  display:flex;
  gap: 0.75rem;
  align-items:center;
  flex-wrap:wrap;
  margin-bottom: 0.75rem;
}

/* ---------- Images uploader ---------- */
.images-section {
  .uploader-root { display:flex; flex-direction:column; gap:12px; }

  .btn-add {
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    background: var(--primary-darker);
    color: var(--white);
    border: 1px solid var(--primary-darker);
    font-weight:700;
    width: max-content;
  }

  .btn-upload {
    padding:8px 12px;
    border-radius:8px;
    border:1px solid var(--border);
    background: var(--surface);
    cursor:pointer;
    color: var(--text-main);
  }

  .note { font-size: 0.9rem; color: var(--text-muted); }

  .preview-grid, .uploaded-grid .thumb-row {
    display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;
  }

  .preview-item, .thumb {
    position:relative; display:inline-block; width:140px; background:var(--surface);
    border-radius: calc(var(--radius) - 4px); overflow:hidden; box-shadow: var(--shadow-sm); border:1px solid var(--border);
  }

  .preview-item img, .thumb img { width:100%; height:110px; object-fit:cover; display:block; }
  .preview-item small, .thumb small { display:block; text-align:center; margin:6px 4px; font-size:0.78rem; color:var(--text-muted); }

  .remove {
    position:absolute; top:6px; right:6px; width:28px; height:28px; border-radius:50%; border:none; background:var(--white);
    cursor:pointer; z-index:2; box-shadow: 0 2px 6px rgba(15,23,42,0.08); font-weight:700; line-height:1;
  }

  @media (max-width: 640px) {
    .preview-item, .thumb { width:120px; }
    .preview-item img, .thumb img { height:90px; }
  }
}

/* ---------- Variants (FormArray) ---------- */
.variants-table {
  width:100%;
  border-collapse:collapse;
  font-size:0.95rem;
  margin-top:0.5rem;
}

/* Desktop header style */
.variants-table thead th {
  padding:10px 8px;
  color:var(--text-muted);
  font-weight:700;
  text-align:left;
}

/* Body cells */
.variants-table tbody td {
  padding: 0px;
}

.variant-input {
  background: linear-gradient(135deg, var(--surface), var(--background));
  border: 2px dashed var(--border);
  border-radius: calc(var(--radius) - 4px);
  padding:0.7rem;
  width:100%;
  transition: all 0.18s ease;
}
.variant-input:hover { border-color: var(--primary); }

.variant-actions { display:flex; gap:8px; align-items:center; }
.variant-actions .btn-primary {
  padding: 0.38rem 0.6rem; font-size:0.86rem; border-radius:8px;
  background: var(--primary-darker); color: var(--white); border:1px solid var(--primary-darker); font-weight:700;
}
.variant-actions .btn-warning {
  padding: 0.34rem 0.54rem; font-size:0.86rem; border-radius:8px;
  background: var(--primary-dark); color:var(--white); border:1px solid var(--primary-dark); font-weight:800;
}

/* Mobile variant layout: horizontally scrollable cards that are easy to use */
@media (max-width: 767.98px) {
  .variants-table {
    display:block;
    thead { display:none; }
    tbody {
      display:flex;
      gap:0.75rem;
      overflow-x:auto;
      padding:0.5rem;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    tbody tr {
      display:block;
      flex:0 0 92%;
      min-width:92%;
      background:var(--surface);
      border-radius:12px;
      padding:12px;
      border:1px solid var(--border);
      box-shadow:var(--shadow-sm);
      scroll-snap-align:center;
    }
    td { display:block; width:100%; padding:6px 0; border:none; }
    td[data-label]::before {
      content: attr(data-label);
      display:block;
      font-weight:700;
      margin-bottom:6px;
      color: var(--text-main);
    }
    .variant-input { width:100%; padding:0.5rem; margin-bottom:2px; font-size:0.95rem; }
    .variant-actions {

      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .variant-actions .btn-primary,
    .variant-actions .btn-warning {
      min-width:70px;
      padding:0.23rem 0.6rem;
      font-size:0.62rem;
    }
  }
}

/* ---------- Size charts ---------- */
.size-charts-selection {
  display:grid; gap:0.75rem;
}

.size-charts-selection .size-chart-option {
  padding:0.8rem;
  border-radius:calc(var(--radius) - 4px);
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--surface);
}
.size-charts-selection .checkbox-label { display:flex; gap:0.6rem; align-items:center; }
.size-charts-selection .primary-option { margin-left:auto; }

/* ---------- Form actions ---------- */
.form-actions {
  display:flex;
  gap:0.75rem;
  justify-content:flex-end;
  align-items:center;
  padding-top:1rem;
  border-top:1px solid var(--border);
  margin-top:1rem;
}

.form-actions .btn-primary {
  background: var(--primary-darker);
  color: var(--white);
  border: 1px solid var(--primary-darker);
}
.form-actions .btn-outline {
  border: 2px solid var(--primary);
  color: var(--primary);
}

/* ---------- Loading overlay & success UI ---------- */
.loading-overlay {
  position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; z-index:12000; background: rgba(15,23,42,0.6);
}
.loading-spinner { background: var(--surface); padding:1.25rem 1.5rem; border-radius:var(--radius); box-shadow: var(--shadow-md); color: var(--text-main); }
.success-message {
  display:flex; gap:1rem; align-items:center; padding:0.85rem; border-radius:calc(var(--radius) - 4px);
  background: linear-gradient(135deg, rgba(110,111,255,0.06), rgba(177,178,255,0.03));
  border: 1px solid rgba(110,111,255,0.06); font-weight:700;
}

/* ---------- ng-select tweaks ---------- */
ng-select, .ng-select { display:block; width:100%; font-family:inherit; font-size:1rem; color:var(--text-main); }
.ng-select .ng-select-container { padding: 0.45rem 0.6rem; min-height:44px; border-radius:calc(var(--radius) - 4px); border:2px solid var(--border); background:var(--white); }

/* ---------- Focus / accessibility ---------- */
a:focus, button:focus, input:focus, textarea:focus, select:focus {
  outline: 2px dashed rgba(110,111,255,0.18);
  outline-offset: 3px;
}

/* ---------- Dark mode ---------- */
@media (prefers-color-scheme: dark) {
  .admin-container { background: linear-gradient(135deg, rgba(110,111,255,0.02), rgba(177,178,255,0.01)); border-color: rgba(255,255,255,0.04); }
  .card { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.04); box-shadow: none; color: var(--white); }
  .variant-input { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.03); }
  .preview-item, .thumb { background: rgba(255,255,255,0.02); border-color: rgba(255,255,255,0.03); }
  .btn-add, .btn-upload, .btn-primary { color: var(--white); }
}

/* ---------- helpers ---------- */
.muted { color: var(--text-muted); font-weight:600; }
.small { font-size: var(--fs-xs); color: var(--text-muted); }
.w-100 { width: 100% !important; }


/* PLACE: append to app/admin/product-upload.component.scss (end of file or inside mobile @media)
   PURPOSE: fix ng-select selected-chips wrapping, limit height on mobile, prevent dropdown clipping.
*/

/* make selected chips wrap and reduce size for mobile + desktop */
ng-select, .ng-select {
  display: block;
  width: 100%;
}

/* Selected tokens (chips) container */
.ng-select .ng-value {
  display: inline-flex;        /* allow wrapping */
  flex-wrap: wrap;             /* wrap chips to new row */
  gap: 0.35rem;
  max-height: 8.2rem;          /* limit height so it doesn't push layout (desktop) */
  overflow-y: auto;            /* allow scrolling inside if many selected */
  padding: 0.25rem 0.35rem;
  align-items: center;
}

/* Individual token/chip */
.ng-select .ng-value .ng-value-label,
.ng-select .ng-value .ng-value {
  white-space: normal;         /* allow multiple lines */
  font-size: 0.85rem;
  padding: 0.18rem 0.38rem;
  border-radius: 6px;
  background: linear-gradient(90deg, rgba(177,178,255,0.08), rgba(177,178,255,0.03));
  color: var(--text-main);
}

/* ensure the control container doesn't clip the dropdown */
.ng-select .ng-select-container {
  overflow: visible !important; /* allow dropdown panel to overflow */
  padding-right: 40px;          /* room for caret */
}

/* dropdown panel fallback and z-index (important when parent is overflow:auto) */
.ng-dropdown-panel {
  z-index: 13000 !important;
}

/* optional: use fixed fallback when ng-select detects clipping */
.ng-dropdown-panel--fallback-fixed {
  position: fixed !important;
  left: 8px !important;
  right: 8px !important;
  top: 12% !important;
  margin: 0 auto;
  z-index: 14000 !important;
}

/* Mobile-specific tuning: smaller chips, smaller spacing */
@media (max-width: 767.98px) {
  .ng-select .ng-value {
    max-height: 6.6rem;     /* fewer rows on small screens */
    gap: 0.25rem;
  }

  .ng-select .ng-value .ng-value-label,
  .ng-select .ng-value .ng-value {
    font-size: 0.78rem;
    padding: 0.14rem 0.28rem;
    border-radius: 6px;
  }

  /* ensure select control is full width and visually matches other inputs */
  .ng-select .ng-select-container {
    min-height: 44px;
    padding: 0.35rem 0.5rem;
  }

  /* add safe bottom space so footer won't cover the last form field */
  .admin-container {
    padding-bottom: calc(var(--footer-height,56px) + 110px);
  }
}
